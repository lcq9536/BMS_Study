/*
 * temperature.c
 *
 *  Created on: 2019年9月10日
 *      Author: Jamie
 */

#include "temperature.h"
//#define T_PCB_TABLE_ADDR    0x7000u
//#pragma ABSOLUTE T_PCB_Table T_PCB_TABLE_ADDR

#define T_END        (125u+55u+1u)

#define B_VALUE
#ifndef B_VALUE
 const unsigned short T_PCB_Table[T_END] =
{
    //0x0FAD
    4013,             //-55[degrees C]
    4008,             //-54[degrees C]
    4003,             //-53[degrees C]
    3997,             //-52[degrees C]
    3991,             //-51[degrees C]
    3985,             //-50[degrees C]
    3978,             //-49[degrees C]
    3971,             //-48[degrees C]
    3964,             //-47[degrees C]
    3956,             //-46[degrees C]
    3948,             //-45[degrees C]
    3939,             //-44[degrees C]
    3931,             //-43[degrees C]
    3921,             //-42[degrees C]
    3911,             //-41[degrees C]
    3901,             //-40[degrees C]
    3891,             //-39[degrees C]
    3879,             //-38[degrees C]
    3868,             //-37[degrees C]
    3856,             //-36[degrees C]
    3843,             //-35[degrees C]
    3830,             //-34[degrees C]
    3816,             //-33[degrees C]
    3802,             //-32[degrees C]
    3787,             //-31[degrees C]
    3771,             //-30[degrees C]
    3755,             //-29[degrees C]
    3738,             //-28[degrees C]
    3721,             //-27[degrees C]
    3703,             //-26[degrees C]
    3685,             //-25[degrees C]
    3665,             //-24[degrees C]
    3646,             //-23[degrees C]
    3625,             //-22[degrees C]
    3604,             //-21[degrees C]
    3582,             //-20[degrees C]
    3559,             //-19[degrees C]
    3536,             //-18[degrees C]
    3512,             //-17[degrees C]
    3487,             //-16[degrees C]
    3462,             //-15[degrees C]
    3436,             //-14[degrees C]
    3409,             //-13[degrees C]
    3382,             //-12[degrees C]
    3354,             //-11[degrees C]
    3325,             //-10[degrees C]
    3296,             //-09[degrees C]
    3266,             //-08[degrees C]
    3235,             //-07[degrees C]
    3204,             //-06[degrees C]
    3172,             //-05[degrees C]
    3140,             //-04[degrees C]
    3107,             //-03[degrees C]
    3073,             //-02[degrees C]
    3039,             //-01[degrees C]
    3004,             // 00[degrees C]
    2969,             // 01[degrees C]
    2933,             // 02[degrees C]
    2897,             // 03[degrees C]
    2861,             // 04[degrees C]
    2824,             // 05[degrees C]
    2786,             // 06[degrees C]
    2749,             // 07[degrees C]
    2711,             // 08[degrees C]
    2673,             // 09[degrees C]
    2634,             // 10[degrees C]
    2596,             // 11[degrees C]
    2557,             // 12[degrees C]
    2518,             // 13[degrees C]
    2478,             // 14[degrees C]
    2439,             // 15[degrees C]
    2400,             // 16[degrees C]
    2361,             // 17[degrees C]
    2321,             // 18[degrees C]
    2282,             // 19[degrees C]
    2243,             // 20[degrees C]
    2203,             // 21[degrees C]
    2164,             // 22[degrees C]
    2125,             // 23[degrees C]
    2087,             // 24[degrees C]
    2048,             // 25[degrees C]
    2010,             // 26[degrees C]
    1972,             // 27[degrees C]
    1934,             // 28[degrees C]
    1896,             // 29[degrees C]
    1859,             // 30[degrees C]
    1822,             // 31[degrees C]
    1785,             // 32[degrees C]
    1749,             // 33[degrees C]
    1713,             // 34[degrees C]
    1678,             // 35[degrees C]
    1643,             // 36[degrees C]
    1609,             // 37[degrees C]
    1574,             // 38[degrees C]
    1541,             // 39[degrees C]
    1508,             // 40[degrees C]
    1475,             // 41[degrees C]
    1443,             // 42[degrees C]
    1411,             // 43[degrees C]
    1380,             // 44[degrees C]
    1349,             // 45[degrees C]
    1319,             // 46[degrees C]
    1290,             // 47[degrees C]
    1260,             // 48[degrees C]
    1232,             // 49[degrees C]
    1203,             // 50[degrees C]
    1176,             // 51[degrees C]
    1149,             // 52[degrees C]
    1123,             // 53[degrees C]
    1097,             // 54[degrees C]
    1071,             // 55[degrees C]
    1046,             // 56[degrees C]
    1022,             // 57[degrees C]
    998,              // 58[degrees C]
    975,              // 59[degrees C]
    952,              // 60[degrees C]
    929,              // 61[degrees C]
    907,              // 62[degrees C]
    886,              // 63[degrees C]
    865,              // 64[degrees C]
    844,              // 65[degrees C]
    824,              // 66[degrees C]
    805,              // 67[degrees C]
    786,              // 68[degrees C]
    767,              // 69[degrees C]
    749,              // 70[degrees C]
    731,              // 71[degrees C]
    713,              // 72[degrees C]
    697,              // 73[degrees C]
    680,              // 74[degrees C]
    664,              // 75[degrees C]
    648,              // 76[degrees C]
    632,              // 77[degrees C]
    617,              // 78[degrees C]
    603,              // 79[degrees C]
    589,              // 80[degrees C]
    574,              // 81[degrees C]
    561,              // 82[degrees C]
    548,              // 83[degrees C]
    535,              // 84[degrees C]
    522,              // 85[degrees C]
    510,              // 86[degrees C]
    498,              // 87[degrees C]
    486,              // 88[degrees C]
    474,              // 89[degrees C]
    464,              // 90[degrees C]
    453,              // 91[degrees C]
    442,              // 92[degrees C]
    432,              // 93[degrees C]
    421,              // 94[degrees C]
    412,              // 95[degrees C]
    402,              // 96[degrees C]
    393,              // 97[degrees C]
    384,              // 98[degrees C]
    375,              // 99[degrees C]
    367,              //100[degrees C]
    358,              //101[degrees C]
    350,              //102[degrees C]
    342,              //103[degrees C]
    334,              //104[degrees C]
    326,              //105[degrees C]
    319,              //106[degrees C]
    312,              //107[degrees C]
    305,              //108[degrees C]
    298,              //109[degrees C]
    291,              //110[degrees C]
    285,              //111[degrees C]
    278,              //112[degrees C]
    272,              //113[degrees C]
    266,              //114[degrees C]
    260,              //115[degrees C]
    255,              //116[degrees C]
    249,              //117[degrees C]
    243,              //118[degrees C]
    238,              //119[degrees C]
    233,              //120[degrees C]
    228,              //121[degrees C]
    223,              //122[degrees C]
    218,              //123[degrees C]
    214,              //124[degrees C]
    209               //125[degrees C]
};
#else
static const unsigned short T_PCB_Table[T_END] =
{
    4013,             //-55[degrees C]
    4008,             //-54[degrees C]
    4003,             //-53[degrees C]
    3997,             //-52[degrees C]
    3991,             //-51[degrees C]
    3985,             //-50[degrees C]
    3978,             //-49[degrees C]
    3971,             //-48[degrees C]
    3964,             //-47[degrees C]
    3956,             //-46[degrees C]
    3948,             //-45[degrees C]
    3939,             //-44[degrees C]
    3931,             //-43[degrees C]
    3921,             //-42[degrees C]
    3911,             //-41[degrees C]
    3901,             //-40[degrees C]
    3891,             //-39[degrees C]
    3879,             //-38[degrees C]
    3868,             //-37[degrees C]
    3856,             //-36[degrees C]
    3843,             //-35[degrees C]
    3830,             //-34[degrees C]
    3816,             //-33[degrees C]
    3802,             //-32[degrees C]
    3787,             //-31[degrees C]
    3771,             //-30[degrees C]
    3755,             //-29[degrees C]
    3738,             //-28[degrees C]
    3721,             //-27[degrees C]
    3703,             //-26[degrees C]
    3685,             //-25[degrees C]
    3665,             //-24[degrees C]
    3646,             //-23[degrees C]
    3625,             //-22[degrees C]
    3604,             //-21[degrees C]
    3582,             //-20[degrees C]
    3559,             //-19[degrees C]
    3536,             //-18[degrees C]
    3512,             //-17[degrees C]
    3487,             //-16[degrees C]
    3462,             //-15[degrees C]
    3436,             //-14[degrees C]
    3409,             //-13[degrees C]
    3382,             //-12[degrees C]
    3354,             //-11[degrees C]
    3325,             //-10[degrees C]
    3296,             //-09[degrees C]
    3266,             //-08[degrees C]
    3235,             //-07[degrees C]
    3204,             //-06[degrees C]
    3172,             //-05[degrees C]
    3140,             //-04[degrees C]
    3107,             //-03[degrees C]
    3073,             //-02[degrees C]
    3039,             //-01[degrees C]
    3004,             // 00[degrees C]
    2969,             // 01[degrees C]
    2933,             // 02[degrees C]
    2897,             // 03[degrees C]
    2861,             // 04[degrees C]
    2824,             // 05[degrees C]
    2786,             // 06[degrees C]
    2749,             // 07[degrees C]
    2711,             // 08[degrees C]
    2673,             // 09[degrees C]
    2634,             // 10[degrees C]
    2596,             // 11[degrees C]
    2557,             // 12[degrees C]
    2518,             // 13[degrees C]
    2478,             // 14[degrees C]
    2439,             // 15[degrees C]
    2400,             // 16[degrees C]
    2361,             // 17[degrees C]
    2321,             // 18[degrees C]
    2282,             // 19[degrees C]
    2243,             // 20[degrees C]
    2203,             // 21[degrees C]
    2164,             // 22[degrees C]
    2125,             // 23[degrees C]
    2087,             // 24[degrees C]
    2048,             // 25[degrees C]
    2010,             // 26[degrees C]
    1972,             // 27[degrees C]
    1934,             // 28[degrees C]
    1896,             // 29[degrees C]
    1859,             // 30[degrees C]
    1822,             // 31[degrees C]
    1785,             // 32[degrees C]
    1749,             // 33[degrees C]
    1713,             // 34[degrees C]
    1678,             // 35[degrees C]
    1643,             // 36[degrees C]
    1609,             // 37[degrees C]
    1574,             // 38[degrees C]
    1541,             // 39[degrees C]
    1508,             // 40[degrees C]
    1475,             // 41[degrees C]
    1443,             // 42[degrees C]
    1411,             // 43[degrees C]
    1380,             // 44[degrees C]
    1349,             // 45[degrees C]
    1319,             // 46[degrees C]
    1290,             // 47[degrees C]
    1260,             // 48[degrees C]
    1232,             // 49[degrees C]
    1203,             // 50[degrees C]
    1176,             // 51[degrees C]
    1149,             // 52[degrees C]
    1123,             // 53[degrees C]
    1097,             // 54[degrees C]
    1071,             // 55[degrees C]
    1046,             // 56[degrees C]
    1022,             // 57[degrees C]
    998,              // 58[degrees C]
    975,              // 59[degrees C]
    952,              // 60[degrees C]
    929,              // 61[degrees C]
    907,              // 62[degrees C]
    886,              // 63[degrees C]
    865,              // 64[degrees C]
    844,              // 65[degrees C]
    824,              // 66[degrees C]
    805,              // 67[degrees C]
    786,              // 68[degrees C]
    767,              // 69[degrees C]
    749,              // 70[degrees C]
    731,              // 71[degrees C]
    713,              // 72[degrees C]
    697,              // 73[degrees C]
    680,              // 74[degrees C]
    664,              // 75[degrees C]
    648,              // 76[degrees C]
    632,              // 77[degrees C]
    617,              // 78[degrees C]
    603,              // 79[degrees C]
    589,              // 80[degrees C]
    574,              // 81[degrees C]
    561,              // 82[degrees C]
    548,              // 83[degrees C]
    535,              // 84[degrees C]
    522,              // 85[degrees C]
    510,              // 86[degrees C]
    498,              // 87[degrees C]
    486,              // 88[degrees C]
    474,              // 89[degrees C]
    464,              // 90[degrees C]
    453,              // 91[degrees C]
    442,              // 92[degrees C]
    432,              // 93[degrees C]
    421,              // 94[degrees C]
    412,              // 95[degrees C]
    402,              // 96[degrees C]
    393,              // 97[degrees C]
    384,              // 98[degrees C]
    375,              // 99[degrees C]
    367,              //100[degrees C]
    358,              //101[degrees C]
    350,              //102[degrees C]
    342,              //103[degrees C]
    334,              //104[degrees C]
    326,              //105[degrees C]
    319,              //106[degrees C]
    312,              //107[degrees C]
    305,              //108[degrees C]
    298,              //109[degrees C]
    291,              //110[degrees C]
    285,              //111[degrees C]
    278,              //112[degrees C]
    272,              //113[degrees C]
    266,              //114[degrees C]
    260,              //115[degrees C]
    255,              //116[degrees C]
    249,              //117[degrees C]
    243,              //118[degrees C]
    238,              //119[degrees C]
    233,              //120[degrees C]
    228,              //121[degrees C]
    223,              //122[degrees C]
    218,              //123[degrees C]
    214,              //124[degrees C]
    209               //125[degrees C]
};
#endif

int Temperature(unsigned short ADValue)   //根据温度的12bitAD值获取温度值
{
    char TempValue=0;
    unsigned char i=0;
    unsigned char a=0,b=0;

    if(ADValue>3901){                   //高于3901均返回-40°
      return -40;
    }

    if(ADValue<209){                    //低于209均返回126°
      return 126;
    }
    if(ADValue >= T_PCB_Table[90])    //判断AD值是否大于T_PCB_Table[90]，为提高效率
    {
        for(i=0;i<=89;i++)
        {
            if((ADValue <= T_PCB_Table[i])&&(ADValue >= T_PCB_Table[i+1]))  //找到最接近的值
            {
                a=T_PCB_Table[i]-ADValue;
                b=ADValue-T_PCB_Table[i+1];
                if(a<b){                        //判断与i接近还是i+1接近
                    TempValue = i-55;
                }else{
                    TempValue = i-54;
                }
                break;
            }
        }
    }
    if(ADValue < T_PCB_Table[90])   //判断AD值是否小于于T_PCB_Table[90]
    {
        for(i=90;i<181;i++)
        {
            if((ADValue <= T_PCB_Table[i])&&(ADValue >= T_PCB_Table[i+1]))    //找到最接近的值
            {
                a=T_PCB_Table[i]-ADValue;
                b=ADValue-T_PCB_Table[i+1];
                if(a<b){                          //判断与i接近还是i+1接近
                    TempValue = i-55;
                }else{
                    TempValue = i-54;
                }
                break;
            }
        }
    }
    return TempValue;
}

